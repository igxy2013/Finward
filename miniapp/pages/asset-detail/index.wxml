<view class="page">
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-spinner"></view>
    <text class="loading-text">加载中...</text>
  </view>
  <view wx:elif="{{error}}" class="error-state">
    <text class="error-text">{{error}}</text>
  </view>
  <view wx:else class="content">
    <view class="card hero-card">
      <view class="card-header">
        <view class="item-icon asset-item-icon">
          <image class="icon-image" src="/assets/icons/{{icon}}" mode="aspectFit"></image>
        </view>
        <view class="header-info">
          <text class="asset-name">{{detail.name}}</text>
          <view class="tags">
            <text class="tag">{{detail.category}}</text>
            <text class="tag type-tag">资产</text>
          </view>
        </view>
        <image class="action-icon" src="/assets/icons/edit-line.svg" mode="aspectFit" bindtap="openEditMenu"></image>
      </view>
      <view class="value-row">
        <text class="value-label">当前估值</text>
        <view class="value">
          <text class="currency">￥</text>
          <text class="amount">{{detail.current_value_display}}</text>
        </view>
      </view>
      <view class="metrics">
        <view class="metric">
          <text class="metric-label">期初金额</text>
          <text class="metric-value">￥{{detail.initial_amount_display}}</text>
        </view>
        <view class="metric">
          <text class="metric-label">变化</text>
          <text class="metric-value {{change_positive ? 'positive' : (change_negative ? 'negative' : '')}}">{{change_sign}}{{detail.change_display}}</text>
        </view>
        <view class="metric">
          <text class="metric-label">最近更新</text>
          <text class="metric-value">{{detail.updated_at_display}}</text>
        </view>
      </view>
    </view>

    <view class="card info-card">
      <view class="card-header">
        <text class="card-title">基本信息</text>
      </view>
      <view class="info-list">
        <view class="info-item"><text class="info-label">分类</text><text class="info-value">{{detail.category}}</text></view>
        <view class="info-item"><text class="info-label">币种</text><text class="info-value">{{detail.currency}}</text></view>
        <view class="info-item"><text class="info-label">创建时间</text><text class="info-value">{{detail.created_at_display}}</text></view>
        <view class="info-item" wx:if="{{detail.next_due_date_display}}"><text class="info-label">到期日</text><text class="info-value">{{detail.next_due_date_display}}</text></view>
      </view>
    </view>

    <view class="card schedule-card" wx:if="{{detail.monthly_payment || detail.loan_term_months || detail.loan_start_date}}">
      <view class="card-header">
        <text class="card-title">还款计划</text>
      </view>
      <view class="info-list">
        <view class="info-item" wx:if="{{detail.monthly_payment}}"><text class="info-label">月供</text><text class="info-value">￥{{detail.monthly_payment_display}}</text></view>
        <view class="info-item" wx:if="{{detail.loan_term_months}}"><text class="info-label">期限</text><text class="info-value">{{detail.loan_term_months}} 个月</text></view>
        <view class="info-item" wx:if="{{detail.loan_start_date_display}}"><text class="info-label">开始日期</text><text class="info-value">{{detail.loan_start_date_display}}</text></view>
      </view>
    </view>

    <view class="card invest-card" wx:if="{{(detail.monthly_income || detail.investment_term_months || detail.invest_start_date) && tenants.length === 0}}">
      <view class="card-header">
        <text class="card-title">投资计划</text>
      </view>
      <view class="info-list">
        <view class="info-item" wx:if="{{detail.monthly_income}}"><text class="info-label">月收益</text><text class="info-value">￥{{detail.monthly_income_display}}</text></view>
        <view class="info-item" wx:if="{{detail.investment_term_months}}"><text class="info-label">期限</text><text class="info-value">{{detail.investment_term_months}} 个月</text></view>
        <view class="info-item" wx:if="{{detail.invest_start_date_display}}"><text class="info-label">开始日期</text><text class="info-value">{{detail.invest_start_date_display}}</text></view>
        <view class="info-item" wx:if="{{detail.depreciation_rate_display}}"><text class="info-label">折旧率(年%)</text><text class="info-value">{{detail.depreciation_rate_display}}%</text></view>
      </view>
    </view>

    <view class="card tenants-card" wx:if="{{tenants.length > 0}}">
      <view class="card-header">
        <view class="card-title-wrap">
          <text class="card-title">出租信息</text>
          <text class="card-subtitle">Rental Details</text>
        </view>
        <button class="rent-btn" bindtap="collectRent">收取租金</button>
      </view>
      <view class="tenant-list">
        <view class="tenant-card" wx:for="{{tenants}}" wx:key="id">
          <view class="tenant-header">
            <text class="tenant-name">{{item.tenant_name}}</text>
            <text class="freq-pill">{{item.frequency_label}}</text>
          </view>
          <view class="rental-info">
            <view class="r-row"><text class="r-label">出租方式</text><text class="r-value">{{item.frequency_label}}</text></view>
            <view class="r-row"><text class="r-label">月租</text><text class="r-value">￥{{item.monthly_rent_display}}</text></view>
            <view class="r-row"><text class="r-label">下次收租</text><text class="r-value">{{item.next_due_date_display}}</text></view>
            <view class="r-row"><text class="r-label">收租日</text><text class="r-value">{{item.due_day_display}}</text></view>
            <view class="r-row"><text class="r-label">开始日期</text><text class="r-value">{{item.start_date_display}}</text></view>
            <view class="r-row" wx:if="{{item.end_date_display}}"><text class="r-label">结束日期</text><text class="r-value">{{item.end_date_display}}</text></view>
            <view class="r-row" wx:if="{{item.contract_number}}"><text class="r-label">合同编号</text><text class="r-value">{{item.contract_number}}</text></view>
            <view class="r-row" wx:if="{{item.contract_url}}"><text class="r-label">合同链接</text><button class="link-btn" data-url="{{item.contract_url}}" bindtap="copyContractUrl">复制</button></view>
            <view class="r-row"><text class="r-label">提醒</text><text class="r-value">{{item.reminder_display}}</text></view>
            <view class="r-row note-row" wx:if="{{item.note}}"><text class="r-label">备注</text><text class="r-value multiline">{{item.note}}</text></view>
          </view>
        </view>
      </view>
    </view>

    <view class="card list-card" wx:if="{{tenants.length > 0 || rentRecords.length > 0}}">
      <view class="card-header">
        <text class="card-title">租金收取记录</text>
        <text class="card-count" wx:if="{{rentRecords.length > 0}}">{{rentRecords.length}} 条</text>
      </view>
      <view class="list-container" wx:if="{{rentRecords.length > 0}}">
        <view class="list-item" wx:for="{{rentRecords}}" wx:key="id" data-id="{{item.id}}" bindlongpress="openRentRecordActions">
          <view class="item-content">
            <view class="item-name">租金收取</view>
            <view class="item-meta">
              <text class="item-category">{{item.note}}</text>
              <text class="item-date">{{item.date_display}}</text>
            </view>
          </view>
          <view class="item-amount positive">+￥{{item.amount_display}}</view>
          <view class="item-actions">
            <image class="action-icon" src="/assets/icons/edit-line.svg" mode="aspectFit" data-id="{{item.id}}" bindtap="editRentRecord"></image>
            <image class="action-icon" src="/assets/icons/delete-bin-line.svg" mode="aspectFit" data-id="{{item.id}}" bindtap="deleteRentRecord"></image>
          </view>
        </view>
      </view>
      <view class="empty-state" wx:else>
        <view class="empty-text">暂无租金收取记录</view>
      </view>
    </view>

    <view class="card note-card" wx:if="{{detail.note}}">
      <view class="card-header">
        <text class="card-title">备注</text>
      </view>
      <view class="note-content">{{detail.note}}</view>
    </view>

    
  </view>
</view>
