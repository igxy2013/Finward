<navbar title="{{pageTitle}}"></navbar>
<view class="page">
  <view class="card form-card">
    <view class="form-item">
      <text class="label">名称*</text>
      <input placeholder="如：招商储蓄卡" data-key="name" value="{{form.name}}" bindinput="handleInput" />
    </view>
    <view class="form-item">
      <text class="label">类型*</text>
      <view class="toggle-tabs">
        <view class="pill asset {{form.type === 'asset' ? 'active' : ''}}" data-value="asset" bindtap="handleTypeToggle">资产</view>
        <view class="pill liability {{form.type === 'liability' ? 'active' : ''}}" data-value="liability" bindtap="handleTypeToggle">负债</view>
      </view>
    </view>
    <view class="form-item">
      <text class="label">分类*</text>
      <view class="picker-value" bindtap="openCategorySelector">{{categoryDisplay}}</view>
    </view>
    <view class="form-item">
      <text class="label">期初金额*
      </text>
      <view class="picker-value" data-key="amount" data-title="期初金额" bindtap="openNKeyboard">
        <text>{{form.amount || '请输入金额'}}</text>
      </view>
    </view>
    <view class="form-item" wx:if="{{form.type === 'liability'}}">
      <text class="label">还贷期限(月)</text>
      <view class="picker-value" data-key="loan_term_months" data-title="还贷期限(月)" bindtap="openNKeyboard">
        <text>{{form.loan_term_months || '可选'}}</text>
      </view>
    </view>
    <view class="form-item" wx:if="{{form.type === 'liability'}}">
      <text class="label">月供</text>
      <view class="picker-value" data-key="monthly_payment" data-title="月供" bindtap="openNKeyboard">
        <text>{{form.monthly_payment || '可选'}}</text>
      </view>
    </view>
    <view class="form-item" wx:if="{{form.type === 'liability'}}">
      <text class="label">年利率(%)</text>
      <view class="picker-value" data-key="annual_interest_rate" data-title="年利率(%)" bindtap="openNKeyboard">
        <text>{{form.annual_interest_rate || '如 5 表示 5%'}}</text>
      </view>
    </view>
    <view class="form-item" wx:if="{{form.type === 'liability'}}">
      <text class="label">开始日期</text>
      <picker mode="date" value="{{form.loan_start_date}}" bindchange="handleDateChangeLoan">
        <view class="picker-value">{{form.loan_start_date || '请选择日期'}}</view>
      </picker>
    </view>
    <view class="form-item" wx:if="{{form.type === 'liability'}}">
      <text class="label">结束日期</text>
      <view class="readonly-value">{{form.loan_end_date || '自动计算'}}</view>
    </view>
    <view class="form-item" wx:if="{{form.type === 'asset' && form.category !== '房产'}}">
      <text class="label">投资期限(月)</text>
      <view class="picker-value" data-key="investment_term_months" data-title="投资期限(月)" bindtap="openNKeyboard">
        <text>{{form.investment_term_months || '可选'}}</text>
      </view>
    </view>
    <view class="form-item" wx:if="{{form.type === 'asset' && form.category !== '房产'}}">
      <text class="label">月收益</text>
      <view class="picker-value" data-key="monthly_income" data-title="月收益" bindtap="openNKeyboard">
        <text>{{form.monthly_income || '可选'}}</text>
      </view>
    </view>
    <view class="form-item" wx:if="{{form.type === 'asset'}}">
      <text class="label">开始日期</text>
      <picker mode="date" value="{{form.invest_start_date}}" bindchange="handleDateChangeAsset">
        <view class="picker-value">{{form.invest_start_date || '请选择日期'}}</view>
      </picker>
    </view>
    <view class="form-item" wx:if="{{form.type === 'asset'}}">
      <text class="label">结束日期</text>
      <picker mode="date" value="{{form.invest_end_date}}" bindchange="handleDateChangeAsset">
        <view class="picker-value">{{form.invest_end_date || '可选'}}</view>
      </picker>
    </view>
    <view class="form-item" wx:if="{{form.type === 'asset' && form.category !== '房产'}}">
      <text class="label">折旧率(年%)</text>
      <view class="picker-value" data-key="depreciation_rate" data-title="折旧率(年%)" bindtap="openNKeyboard">
        <text>{{form.depreciation_rate || '如 10 表示 10%/年'}}</text>
      </view>
    </view>
    <view class="form-item" wx:if="{{form.type === 'asset'}}">
      <text class="label">资产现值</text>
      <view class="readonly-value">￥{{current_value_display}}</view>
    </view>
    <view class="form-item" wx:if="{{form.type === 'liability'}}">
      <text class="label">负债现值</text>
      <view class="readonly-value">￥{{current_value_display}}</view>
    </view>
    <view wx:if="{{form.type === 'asset' && form.category === '房产'}}" class="card rental-card">
      <view class="form-item row">
        <text class="label">是否出租</text>
        <switch checked="{{form.rental_enabled}}" bindchange="handleRentalToggle"></switch>
      </view>
      <view wx:if="{{form.rental_enabled}}" class="rent-menu" bindtap="goRentDetail" hover-class="rent-menu--pressed" hover-start-time="0" hover-stay-time="120">
        <view class="rent-menu-row">
          <text class="rent-menu-title">出租信息</text>
          <view class="rent-menu-right">
            <text class="rent-menu-tip">查看</text>
            <image class="rent-menu-arrow" src="/assets/icons/arrow-right-s-line.svg" mode="aspectFit" />
          </view>
        </view>
      </view>
    </view>
    <view class="form-item">
      <text class="label">备注</text>
      <textarea placeholder="可选" data-key="note" value="{{form.note}}" bindinput="handleInput" />
    </view>
    <button bindtap="submit" loading="{{submitting}}" style="background-color: #43B176; color: #ffffff;">保存</button>
  </view>
  <option-selector visible="{{showCategorySelector}}" title="选择分类" options="{{categoryOptionsWithIcon}}" active="{{form.category}}" bind:close="closeCategorySelector" bind:select="onCategorySelected"></option-selector>
  <numeric-keyboard visible="{{nKeyboardVisible}}" value="{{nKeyboardValue}}" maxLength="{{nKeyboardMaxLength}}" maxDecimals="{{nKeyboardMaxDecimals}}" title="{{nKeyboardTitle}}" theme="{{form.type === 'income' ? 'income' : 'expense'}}" saveDisabled="{{submitting}}" saveButtonText="{{editId ? '更新' : '保存'}}" bind:input="onNKeyboardInput" bind:confirm="onNKeyboardConfirm" bind:save="onNKeyboardSave" bind:close="onNKeyboardClose" />
</view>
